# roadmap: absolute paths via `@src` alias

---

## phase 1: update typescript/best-practice

### step 1.1: update tsconfig.json with paths configuration

- [ ] **task**: add `baseUrl` and `paths` to `src/practices/typescript/best-practice/tsconfig.json`

**depends on**: nothing

**acceptance criteria**:
- tsconfig.json contains `"baseUrl": "."`
- tsconfig.json contains `"paths": { "@src/*": ["src/*"] }`
- existing compilerOptions are preserved

**verification**:
```bash
# verify tsconfig.json contains paths config
grep -q '"baseUrl"' src/practices/typescript/best-practice/tsconfig.json && echo "✅ baseUrl present" || echo "❌ baseUrl missing"
grep -q '"@src/\*"' src/practices/typescript/best-practice/tsconfig.json && echo "✅ @src/* path present" || echo "❌ @src/* path missing"
```

---

### step 1.2: add tsc-alias dependency to package.json

- [ ] **task**: add `tsc-alias` to devDependencies in `src/practices/typescript/best-practice/package.json`

**depends on**: nothing (can run parallel with 1.1)

**acceptance criteria**:
- package.json devDependencies contains `"tsc-alias": "@declapract{check.minVersion('1.8.10')}"`

**verification**:
```bash
# verify tsc-alias is in package.json
grep -q 'tsc-alias' src/practices/typescript/best-practice/package.json && echo "✅ tsc-alias present" || echo "❌ tsc-alias missing"
```

---

### step 1.3: update build:compile script in package.json

- [ ] **task**: update `build:compile` script to include `tsc-alias` post-processing

**depends on**: step 1.2

**acceptance criteria**:
- `build:compile` script contains `tsc-alias -p ./tsconfig.build.json`
- tsc-alias runs after tsc compilation

**verification**:
```bash
# verify build:compile includes tsc-alias
grep -q 'tsc-alias' src/practices/typescript/best-practice/package.json && \
  grep -A1 '"build:compile"' src/practices/typescript/best-practice/package.json | grep -q 'tsc-alias' && \
  echo "✅ build:compile includes tsc-alias" || echo "❌ build:compile missing tsc-alias"
```

---

### step 1.4: update .declapract.readme.md

- [ ] **task**: add documentation about `@src/*` path alias to readme

**depends on**: steps 1.1, 1.2, 1.3

**acceptance criteria**:
- readme mentions `@src/*` path alias
- readme explains why absolute imports are beneficial

**verification**:
```bash
# verify readme mentions @src
grep -q '@src' src/practices/typescript/best-practice/.declapract.readme.md && echo "✅ readme documents @src" || echo "❌ readme missing @src docs"
```

---

### step 1.5: verify phase 1 complete

- [ ] **task**: run type check to ensure best-practice files are valid

**depends on**: steps 1.1, 1.2, 1.3, 1.4

**acceptance criteria**:
- `npm run test:types` passes
- no typescript errors in best-practice files

**verification**:
```bash
npm run test:types
echo "✅ phase 1 complete: typescript/best-practice updated"
```

---

## phase 2: create bad-practice for relative imports

### step 2.1: create bad-practice directory structure

- [ ] **task**: create `src/practices/typescript/bad-practices/relative-imports/` directory

**depends on**: phase 1 complete

**acceptance criteria**:
- directory exists at `src/practices/typescript/bad-practices/relative-imports/`

**verification**:
```bash
# verify directory exists
[ -d "src/practices/typescript/bad-practices/relative-imports" ] && echo "✅ directory exists" || echo "❌ directory missing"
```

---

### step 2.2: create check/fix logic file

- [ ] **task**: create `src/practices/typescript/bad-practices/relative-imports/src/**/*.ts.declapract.ts`

**depends on**: step 2.1

**acceptance criteria**:
- file exports `check: FileCheckFunction`
- file exports `fix: FileFixFunction`
- `check` detects `../` imports within `src/` files
- `check` ignores files outside `src/`
- `check` ignores same-directory imports (`./`)
- `fix` rewrites `../` imports to `@src/` imports

**verification**:
```bash
# verify file exists and exports check/fix
FILE="src/practices/typescript/bad-practices/relative-imports/src/**/*.ts.declapract.ts"
[ -f "$FILE" ] && echo "✅ declapract file exists" || echo "❌ declapract file missing"
grep -q 'export const check' "$FILE" && echo "✅ check exported" || echo "❌ check not exported"
grep -q 'export const fix' "$FILE" && echo "✅ fix exported" || echo "❌ fix not exported"
```

---

### step 2.3: create unit tests

- [ ] **task**: create `src/practices/typescript/bad-practices/relative-imports/src/**/*.ts.declapract.test.ts`

**depends on**: step 2.2

**acceptance criteria**:
- test file imports check and fix from declapract file
- tests cover: detecting `../` imports
- tests cover: ignoring `./` imports
- tests cover: ignoring files outside `src/`
- tests cover: ignoring `@src/` imports (already correct)
- tests cover: fix rewrites single `../` import
- tests cover: fix rewrites deeply nested `../../..` imports
- tests cover: fix preserves `./` imports

**verification**:
```bash
# run unit tests for the new bad-practice
npm run test:unit -- relative-imports
```

---

### step 2.4: verify check function behavior

- [ ] **task**: manually verify check function detects bad practice correctly

**depends on**: step 2.3

**acceptance criteria**:

| input | expected |
|-------|----------|
| `import { x } from '../utils/helper'` in `src/domain/User.ts` | match (bad practice) |
| `import { x } from '../../utils/helper'` in `src/domain/nested/User.ts` | match (bad practice) |
| `import { x } from './helper'` in `src/utils/index.ts` | no match (acceptable) |
| `import { x } from '@src/utils/helper'` in `src/domain/User.ts` | no match (already correct) |
| `import { x } from '../utils/helper'` in `acceptance/test.ts` | no match (outside src/) |

**verification**:
```bash
npm run test:unit -- relative-imports --verbose
# all check tests should pass
```

---

### step 2.5: verify fix function behavior

- [ ] **task**: manually verify fix function rewrites imports correctly

**depends on**: step 2.4

**acceptance criteria**:

| input file | input import | expected output |
|------------|--------------|-----------------|
| `src/domain/User.ts` | `from '../utils/helper'` | `from '@src/utils/helper'` |
| `src/domain/objects/User.ts` | `from '../../utils/config'` | `from '@src/utils/config'` |
| `src/domain/User.ts` | `from './helper'` | `from './helper'` (unchanged) |

**verification**:
```bash
npm run test:unit -- relative-imports --verbose
# all fix tests should pass
```

---

### step 2.6: create readme documentation

- [ ] **task**: create `src/practices/typescript/bad-practices/relative-imports/.declapract.readme.md`

**depends on**: step 2.2

**acceptance criteria**:
- readme explains what the bad practice is
- readme explains why it's bad
- readme shows before/after examples

**verification**:
```bash
# verify readme exists and has content
FILE="src/practices/typescript/bad-practices/relative-imports/.declapract.readme.md"
[ -f "$FILE" ] && echo "✅ readme exists" || echo "❌ readme missing"
[ -s "$FILE" ] && echo "✅ readme has content" || echo "❌ readme is empty"
```

---

### step 2.7: verify phase 2 complete

- [ ] **task**: run full test suite to ensure bad-practice works

**depends on**: steps 2.1-2.6

**acceptance criteria**:
- `npm run test:unit` passes
- `npm run test:types` passes
- bad-practice is properly structured

**verification**:
```bash
npm run test:unit
npm run test:types
echo "✅ phase 2 complete: bad-practice created"
```

---

## phase 3: final verification

### step 3.1: run full test suite

- [ ] **task**: verify all tests pass

**depends on**: phases 1 and 2 complete

**acceptance criteria**:
- `npm run test:unit` passes
- `npm run test:types` passes
- `npm run test:lint` passes

**verification**:
```bash
npm run test:unit && npm run test:types && npm run test:lint
```

---

### step 3.2: build and validate

- [ ] **task**: verify build and declapract validation pass

**depends on**: step 3.1

**acceptance criteria**:
- `npm run build` succeeds
- `npm run test:validate` succeeds

**verification**:
```bash
npm run build
npm run test:validate
echo "✅ build and validation passed"
```

---

### step 3.3: test against example project (optional)

- [ ] **task**: apply practice to a test project to verify end-to-end

**depends on**: step 3.2

**acceptance criteria**:
- declapract correctly flags relative imports in test project
- declapract fix correctly rewrites imports to `@src/*`
- test project compiles with rewritten imports

**verification**:
```bash
# in a test project with relative imports:
npx declapract plan
npx declapract apply
npm run test:types
```

---

## summary checklist

### phase 1: typescript/best-practice
- [ ] 1.1 update tsconfig.json with paths
- [ ] 1.2 add tsc-alias dependency
- [ ] 1.3 update build:compile script
- [ ] 1.4 update readme
- [ ] 1.5 verify phase 1

### phase 2: bad-practice for relative imports
- [ ] 2.1 create directory structure
- [ ] 2.2 create check/fix logic
- [ ] 2.3 create unit tests
- [ ] 2.4 verify check behavior
- [ ] 2.5 verify fix behavior
- [ ] 2.6 create readme
- [ ] 2.7 verify phase 2

### phase 3: final verification
- [ ] 3.1 run full test suite
- [ ] 3.2 build and validate
- [ ] 3.3 test against example project (optional)
