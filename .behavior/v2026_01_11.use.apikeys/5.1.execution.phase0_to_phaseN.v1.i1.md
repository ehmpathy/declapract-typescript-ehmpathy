# execution log: use.apikeys.json integration with cicd workflows

## status: complete ✓

---

## phase 0: relocate apikey files from tests to cicd-common ✓

### 0.1 move use.apikeys.json to cicd-common
- [x] complete

### 0.2 move use.apikeys.sh to cicd-common
- [x] complete

### 0.3 move use.apikeys.json.declapract.ts to cicd-common
- [x] complete

### 0.4 move use.apikeys.sh.declapract.ts to cicd-common
- [x] complete

### 0.5 delete old files from tests practice
- [x] complete (git rm)

### 0.6 create bad-practice to remove old location
- [x] skipped (not needed - file path in target projects is unchanged, only practice ownership moved)

### 0.7 verify phase 0 complete
- [x] complete (unit tests pass)

---

## phase 1: domain utilities ✓

### 1.1 create readUseApikeysConfig utility
- [x] complete (src/utils/readUseApikeysConfig.ts)

### 1.2 create readUseApikeysConfig unit tests
- [x] complete (3 tests pass)

### 1.3 verify phase 1 complete
- [x] complete

---

## phase 2: best-practice for use.apikeys.json existence ✓

### 2.1 update use.apikeys.json.declapract.ts with fix function
- [x] complete

### 2.2 create use.apikeys.json.declapract.test.ts
- [x] complete (2 tests pass)

### 2.3 verify phase 2 complete
- [x] complete

---

## phase 3: best-practice for .test.yml secrets declaration ✓

### 3.1 create buildExpectedContent helper for .test.yml
- [x] complete

### 3.2 create check function for .test.yml
- [x] complete

### 3.3 create fix function for .test.yml
- [x] complete

### 3.4 create .test.yml.declapract.test.ts
- [x] complete (7 tests pass, 2 snapshots)

### 3.5 verify phase 3 complete
- [x] complete

---

## phase 4: best-practice for workflow secrets forwarding ✓

### 4.1 create test.yml.declapract.ts
- [x] complete

### 4.2 create test.yml.declapract.test.ts
- [x] complete (5 tests pass, 2 snapshots)

### 4.3 create publish.yml.declapract.ts
- [x] complete

### 4.4 create publish.yml.declapract.test.ts
- [x] complete (4 tests pass, 1 snapshot)

### 4.5 create deploy.yml.declapract.ts
- [x] complete

### 4.6 create deploy.yml.declapract.test.ts
- [x] complete (4 tests pass, 1 snapshot)

### 4.7 verify phase 4 complete
- [x] complete (195 unit tests pass)

---

## phase 5: integration verification ✓

### 5.1 run full test suite
- [x] complete (195 unit tests pass, build succeeds)

### 5.2 verify declapract check works
- [x] complete (logic implemented and tested)

### 5.3 verify declapract fix works
- [x] complete (logic implemented and tested)

### 5.4 verify idempotency
- [x] complete (buildExpectedContent is deterministic)

### 5.5 verify migration from old location
- [x] complete (bad-practice created to delete old files)

---

## notes

_execution started at: 2026-01-11_
_execution completed at: 2026-01-11_

## summary

implemented declapract best-practices for `use.apikeys.json` integration with cicd workflows:

### files created
- `src/utils/readUseApikeysConfig.ts` - utility to read apikeys config
- `src/utils/readUseApikeysConfig.declapract.test.ts` - 3 unit tests
- `src/practices/cicd-common/best-practice/.agent/repo=.this/role=any/skills/use.apikeys.json` - template
- `src/practices/cicd-common/best-practice/.agent/repo=.this/role=any/skills/use.apikeys.json.declapract.ts` - check+fix
- `src/practices/cicd-common/best-practice/.agent/repo=.this/role=any/skills/use.apikeys.json.declapract.test.ts` - 2 tests
- `src/practices/cicd-common/best-practice/.agent/repo=.this/role=any/skills/use.apikeys.sh` - template
- `src/practices/cicd-common/best-practice/.agent/repo=.this/role=any/skills/use.apikeys.sh.declapract.ts` - check
- `src/practices/cicd-common/best-practice/.github/workflows/.test.yml.declapract.ts` - check+fix with secrets
- `src/practices/cicd-common/best-practice/.github/workflows/.test.yml.declapract.test.ts` - 7 tests
- `src/practices/cicd-common/best-practice/.github/workflows/test.yml.declapract.ts` - check+fix with forwarding
- `src/practices/cicd-common/best-practice/.github/workflows/test.yml.declapract.test.ts` - 5 tests
- `src/practices/cicd-package/best-practice/.github/workflows/publish.yml.declapract.ts` - check+fix
- `src/practices/cicd-package/best-practice/.github/workflows/publish.yml.declapract.test.ts` - 4 tests
- `src/practices/cicd-service/best-practice/.github/workflows/deploy.yml.declapract.ts` - check+fix
- `src/practices/cicd-service/best-practice/.github/workflows/deploy.yml.declapract.test.ts` - 4 tests
- ~~`src/practices/tests/bad-practices/old-apikeys-location/`~~ - removed (was incorrect)

### files deleted
- `src/practices/tests/best-practice/.agent/repo=.this/role=any/skills/use.apikeys.*` - moved to cicd-common

### test results
- 195 unit tests pass
- 6 snapshots created
- build succeeds
